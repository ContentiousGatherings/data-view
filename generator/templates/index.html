{% extends "base.html" %}

{% block title %}CG Review - Home{% endblock %}

{% block content %}
<h1>Contentious Gatherings Pipeline Review</h1>

<p class="intro">
    Browse extracted entities from the pipeline. Each page includes review buttons
    to submit corrections via GitHub Issues.
</p>

{% macro stat_card(type_key, type_name) %}
{% set type_stats = stats[type_key] %}
<div class="stat-card">
    <h2>
        <a href="{{ base_url }}/{{ type_key }}/">{{ type_name }}</a>
    </h2>
    <div class="stat-total">{{ type_stats.total }} total</div>
    <div class="stat-breakdown">
        <span class="stat-valid">{{ type_stats.valid }} valid</span>
        <span class="stat-invalid">{{ type_stats.invalid }} invalid</span>
        <span class="stat-blocked">{{ type_stats.blocked }} blocked</span>
        <span class="stat-unknown">{{ type_stats.unknown }} pending</span>
    </div>
    <div class="stat-bar">
        {% set total = type_stats.total or 1 %}
        <div class="bar-valid" style="width: {{ (type_stats.valid / total * 100)|round(1) }}%"></div>
        <div class="bar-invalid" style="width: {{ (type_stats.invalid / total * 100)|round(1) }}%"></div>
        <div class="bar-blocked" style="width: {{ (type_stats.blocked / total * 100)|round(1) }}%"></div>
        <div class="bar-unknown" style="width: {{ (type_stats.unknown / total * 100)|round(1) }}%"></div>
    </div>
</div>
{% endmacro %}

{% for row in entity_rows %}
    {% if row == "pipeline" %}
    <div class="pipeline-columns">
        {% for column in pipeline_columns %}
        <div class="pipeline-column">
            {% for type_key, type_name in column %}
                {{ stat_card(type_key, type_name) }}
            {% endfor %}
        </div>
        {% endfor %}
    </div>
    {% elif row|length == 1 %}
    <div class="stats-grid stats-grid-centered">
        {% for type_key, type_name in row %}
            {{ stat_card(type_key, type_name) }}
        {% endfor %}
    </div>
    {% else %}
    <div class="stats-grid">
        {% for type_key, type_name in row %}
            {{ stat_card(type_key, type_name) }}
        {% endfor %}
    </div>
    {% endif %}
{% endfor %}

<section class="instructions">
    <h2>How to Review</h2>
    <ol>
        <li>Navigate to any entity page</li>
        <li>Click one of the review buttons:
            <ul>
                <li><strong>Valid</strong> - Confirm the entity is correct</li>
                <li><strong>Invalid</strong> - Flag as unusable (edit the reason)</li>
                <li><strong>Block</strong> - Flag as blocked / needs manual review (edit the reason)</li>
                <li><strong>Report</strong> - Report a general problem (edit the description)</li>
            </ul>
        </li>
        <li>Edit the pre-filled JSON if needed, then submit the issue</li>
        <li>A GitHub Action will validate and log the correction</li>
    </ol>
</section>
{% endblock %}
